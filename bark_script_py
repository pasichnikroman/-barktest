import torch
import numpy as np
from bark import SAMPLE_RATE, generate_audio
from scipy.io.wavfile import write as write_wav

# Optional patch for older versions
old_load = torch.load
def patched_load(*args, **kwargs):
    kwargs['weights_only'] = False
    return old_load(*args, **kwargs)
torch.load = patched_load

# Check device
device = "cuda" if torch.cuda.is_available() else "cpu"
print(f"Using device: {device}")

# Your text prompt
text_prompt = "Hello! I'm an AI singer created by Suno."

# Generate audio (BARK will use GPU if available)
audio_array = generate_audio(text_prompt)

# Save output to host-mounted folder
write_wav("output.wav", SAMPLE_RATE, audio_array)
print("âœ… Saved to output.wav")
